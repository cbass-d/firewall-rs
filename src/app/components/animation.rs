use crossterm::event::KeyEvent;
use rand::Rng;
use ratatui::widgets::Block;
use ratatui::widgets::Borders;
use ratatui::widgets::Padding;
use ratatui::widgets::Paragraph;

use super::Action;
use super::AppContext;
use super::mpsc;
use super::{Component, ComponentRender, Props};

const FRAMES: &[&str] = &[
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|███|   |███|███|   
     +---+---+---+---+---+---+---+   
     |   |███|███|███|   |███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|   |███|   |███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███    |███|███|███|   |███|   
     +---+---+---+---+---+---+---+   
     |███|███|   |███|███|   |███|   
     +---+---+---+---+---+---+---+   
     |███|   |███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |   |███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |   |███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|   |███|   |███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███    |███|███|███|   |███|   
     +---+---+---+---+---+---+---+   
     |███|███|   |███|███|   |███|   
     +---+---+---+---+---+---+---+   
     |███|   |███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|   |███|███|███|   |███|   
     +---+---+---+---+---+---+---+   
     |███|███|   |███|   |███|███|   
     +---+---+---+---+---+---+---+   
     |   |███|███|   |███|███|   |   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |   |███|   |███|   |███|   |   
     +---+---+---+---+---+---+---+   
     |███|   |███|   |███|   |███|   
     +---+---+---+---+---+---+---+   
     |   |███|   |███|   |███|   |   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|   |███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|   |   |███|   |   |███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|   |███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|   |███|   |███|   |███|   
     +---+---+---+---+---+---+---+   
     |   |███|   |███|   |███|   |   
     +---+---+---+---+---+---+---+   
     |███|   |███|   |███|   |███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |   |   |   |███|   |   |   |   
     +---+---+---+---+---+---+---+   
     |   |███|███|███|███|███|   |   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |   |   |   |   |   |   |   |   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |   |███|   |███|   |███|   |   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |   |███|   |███|   |███|   |   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |   |   |   |███|   |   |   |   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|   |███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|   |███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|   |███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
     |███|   |   |   |   |   |███|   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|   |███|   |███|   |███|   
     +---+---+---+---+---+---+---+   
     |███|   |███|   |███|   |███|   
     +---+---+---+---+---+---+---+   
     |███|   |███|   |███|   |███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |   |   |███|███|███|   |   |   
     +---+---+---+---+---+---+---+   
     |   |███|███|███|███|███|   |   
     +---+---+---+---+---+---+---+   
     |███|███|███|███|███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|   |   |   |███|███|   
     +---+---+---+---+---+---+---+   
     |███|   |   |   |   |   |███|   
     +---+---+---+---+---+---+---+   
     |███|███|   |   |   |███|███|   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |   |   |   |   |███|███|███|   
     +---+---+---+---+---+---+---+   
     |   |   |   |███|███|███|   |   
     +---+---+---+---+---+---+---+   
     |   |   |███|███|███|   |   |   
     +---+---+---+---+---+---+---+   
"#,
    r#"     +---+---+---+---+---+---+---+   
     |███|███|███|   |   |   |   |   
     +---+---+---+---+---+---+---+   
     |   |   |███|███|   |   |   |   
     +---+---+---+---+---+---+---+   
     |   |   |   |   |███|███|███|   
     +---+---+---+---+---+---+---+   
"#,
];

pub struct Animation {
    frame: usize,
}

impl Component for Animation {
    fn new(context: &AppContext, action_tx: mpsc::UnboundedSender<Action>) -> Self
    where
        Self: Sized,
    {
        Self { frame: 0 }
    }
    fn update(self, context: &AppContext) -> Self
    where
        Self: Sized,
    {
        let mut rng = rand::thread_rng();
        Self {
            frame: rng.gen_range(0..22) as usize,
        }
    }
    fn handle_key_event(&mut self, key: KeyEvent) {}
}

impl ComponentRender<Props> for Animation {
    fn render(&mut self, frame: &mut ratatui::Frame, props: Props) {
        let image = Paragraph::new(FRAMES[self.frame])
            .block(
                Block::default()
                    .borders(Borders::all())
                    .padding(Padding::uniform(1)),
            )
            .centered();

        frame.render_widget(image, props.area);
    }
}
